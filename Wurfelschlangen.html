<!doctype HTML>
<html>
<head>
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

<script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
<script src="https://raw.githack.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
<script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
<script>
AFRAME.registerComponent("lerpsmooth", {
  init: function() {
    this.target = document.querySelector('#smoothed-box');
    this.prevPosition = null;
    this.prevRotation = null;
  },
  tick: function() {
    // if marker is visible
    if (this.el.object3D.visible) {
      // also make the object-to-smooth visible
      this.target.setAttribute('visible', 'true')
      // if we know about the previous position
      if(this.prevPosition) {
        // smooth position
        this.target.object3D.position.lerp(this.prevPosition, 0.1)

        // smooth rotation
        let rot = this.target.object3D.rotation.toVector3().lerp(this.prevRotation, 0.1)
        this.target.object3D.rotation.setFromVector3(rot)
      } 
      // we don't know about the previous position
      else { 
        // initial values to start with
        var initialPosition = this.el.getAttribute('position')
        var initialRotation = this.el.getAttribute('rotation')
        // TODO This does not take into account the initial `position` and `rotation` values of the target, so everything starts at the marker with 0 0 0
        this.target.setAttribute('position', initialPosition)
        this.target.setAttribute('rotation', initialRotation)
      }
      // cache position for next tick
      this.prevPosition = this.el.object3D.position
      this.prevRotation = this.el.object3D.rotation
    } 
    // marker is not visible
    else { 
      // also make the object-to-smooth invisible
      this.target.setAttribute('visible', 'false')
      // reset the cache position
      this.prevPosition = null;
      this.prevRotation = null;
    }
  }
})
</script>
</head>
	
<body style='margin : 0px; overflow: hidden;'>
<!-- we add detectionMode and matrixCodeType to tell AR.js to recognize barcode markers -->
<a-scene embedded vr-mode-ui="enabled: false" arjs="sourceType: webcam; debugUIEnabled: true; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"> 

	<!--Marker 1 -->
  <a-marker lerpsmooth type='barcode' value='1'>
    <a-entity 
					  position="0 0 0"
					  scale="0.2 0.2 0.2"
					  rotation="-43 44 -31"
					  obj-model="obj: url(https://raw.githubusercontent.com/Ivvey/ARGeometry/master/Wurfelschlangen/Modelle/1a.obj); 
								 mtl: url(https://raw.githubusercontent.com/Ivvey/ARGeometry/master/Wurfelschlangen/Modelle/1a.mtl)"> </a-entity>
  </a-marker>
  
  <!-- Marker 2 -->
  <a-marker type='barcode' value='2'>
    <a-entity 
					  position="0 0 0"
					  scale="0.2 0.2 0.2"
					  rotation="62 162 34"
					  obj-model="obj: url(https://raw.githubusercontent.com/Ivvey/ARGeometry/master/Wurfelschlangen/Modelle/1b.obj); 
								 mtl: url(https://raw.githubusercontent.com/Ivvey/ARGeometry/master/Wurfelschlangen/Modelle/1b.mtl)"> </a-entity>
  </a-marker>
  
  <!-- Marker 3 -->
  <a-marker type='barcode' value='3'>
    <a-entity 
					  position="0 0 0"
					  scale="0.2 0.2 0.2"
					  rotation="100 250 65"
					  obj-model="obj: url(https://raw.githubusercontent.com/Ivvey/ARGeometry/master/Wurfelschlangen/Modelle/1a.obj); 
								 mtl: url(https://raw.githubusercontent.com/Ivvey/ARGeometry/master/Wurfelschlangen/Modelle/1a.mtl)"> </a-entity>
  </a-marker>
  
  <!-- Marker 4 -->
  <a-marker type='barcode' value='4'>
    <a-entity 
					  position="0 0 0"
					  scale="0.2 0.2 0.2"
					  rotation="-45 1 5"
					  obj-model="obj: url(https://raw.githubusercontent.com/Ivvey/ARGeometry/master/Wurfelschlangen/Modelle/1a.obj); 
								 mtl: url(https://raw.githubusercontent.com/Ivvey/ARGeometry/master/Wurfelschlangen/Modelle/1a.mtl)"> </a-entity>
  </a-marker>

	<a-camera-static/>
</a-scene>
</body>
</html>
